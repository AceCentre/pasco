workflows:
  release-testflight:
    environment:
      node: 14.19.0
      npm: latest
    publishing:
      app_store_connect:
        api_key: $APP_STORE_CONNECT_PRIVATE_KEY
        key_id: $APP_STORE_CONNECT_KEY_IDENTIFIER
        issuer_id: $APP_STORE_CONNECT_ISSUER_ID
        submit_to_testflight: true
        beta_groups:
          - Beta Testers
    scripts:
      - name: Install dependencies
        script: npm install

      - name: Install cordova deps
        working_directory: ./cordova
        script: npm install

      - name: Build web contents
        script: npm run build-prod

      - name: Build cordova distribution
        script: npm run cordova-dist

      - name: Add ios to cordova build
        working_directory: ./cordova
        script: npm run add-ios

      - name: Build ios
        working_directory: ./cordova
        script: npm run cordova-build
