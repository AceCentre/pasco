<html>
    <head>
        <title>Pasco Tests</title>
        <script src="../html/bower_components/underscore/underscore-min.js"></script>
        <script src="../html/js/core.js"></script>
    </head>
    
    <body>
        <h1>Pasco tests</h1>

        <ul id="test-list">
           
        </ul>
        

        <script>
            (async () => {
                const tests = [
                    {
                        group: "fs_friendly_name",
                        description: "Removes http://",
                        test: function() {
                            const result = fs_friendly_name("http://www.google.com");
                            return result === "www.google.com";
                        }
                    },
                    {
                        group: "fs_friendly_name",
                        description: "Removes https://",
                        test: function() {
                            const result = fs_friendly_name("https://www.google.com");
                            return result === "www.google.com";
                        }
                    },
                    {
                        group: "fs_friendly_name",
                        description: "Removes random protocol",
                        test: function() {
                            const result = fs_friendly_name("myproto://www.google.com");
                            return result === "www.google.com";
                        }
                    },
                    {
                        group: "fs_friendly_name",
                        description: "Removes query string",
                        test: function() {
                            const result = fs_friendly_name("www.google.com?q=test");
                            return result === "www.google.com";
                        }
                    },
                    {
                        group: "fs_friendly_name",
                        description: "Removes newline",
                        test: function() {
                            const result = fs_friendly_name("www.go\nogle.com");
                            return result === "www.google.com";
                        }
                    },
                    {
                        group: "fs_friendly_name",
                        description: "Removes /",
                        test: function() {
                            const result = fs_friendly_name("www.google.com/test");
                            return result === "www.google.com_test";
                        }
                    },
                    {
                        group: "prepare_tree",
                        description: "Throws an error when nothing is passed",
                        test: function() {
                            try {
                                prepare_tree();
                                return false
                            } catch (error) {
                                return error.message === "Invalid argument"
                            }
                        }
                    },
                ];

                var testList = document.getElementById("test-list");

                const uniqueGroups = [...new Set(tests.map(x => x.group))];

                for(const group of uniqueGroups) {
                    const groupItem = document.createElement("li");
                    groupItem.innerHTML = `${group}<ul id="${group}"></ul`;
                    testList.appendChild(groupItem);
                }

                for(const current of tests) {
                    const currentList = document.getElementById(current.group);
                    const result = await current.test();
                    const testItem = document.createElement("li");
                    testItem.innerHTML = `${current.description} - ${result ? "✅" : "❌"}`;
                    currentList.appendChild(testItem);
                }
            })()
        </script>
    </body>
<html>